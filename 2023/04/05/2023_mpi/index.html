<!DOCTYPE html><html class="appearance-auto" lang="en"><head><meta charset="UTF-8"><title>MPI notes</title><meta name="description"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/favicon.ico"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="Crash MPIFollowing are basically the note when I went through https://www.hlrs.de/training/self-study-materials. This tutorial is highly recommended as it contains plenty of informative code exercises!
OverviewSequential vs ParallelSequential - One memory, one processor; all the works done in linear order
Parallel - Many memories, many processors; at diffe.."><meta name="generator" content="Hexo 6.2.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">pointeee's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">MPI notes</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Click back to the top</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/about">About</a></h3><h3 class="is-inline-block"><a href="/archives">Archive</a></h3><h3 class="is-inline-block"><a href="/Friends">Friends</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/about">About</a></h3><h3 class="is-inline-block"><a href="/archives">Archive</a></h3><h3 class="is-inline-block"><a href="/Friends">Friends</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Crash-MPI"><span class="toc-text">Crash MPI</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Overview"><span class="toc-text">Overview</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Sequential-vs-Parallel"><span class="toc-text">Sequential vs Parallel</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SPMD"><span class="toc-text">SPMD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rank-in-MPI"><span class="toc-text">rank in MPI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#First-MPI-example"><span class="toc-text">First MPI example</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bottom-lines"><span class="toc-text">Bottom lines</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Messages-among-processors"><span class="toc-text">Messages among processors</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#P2P-Communication"><span class="toc-text">P2P Communication</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Synchronous-send"><span class="toc-text">Synchronous send</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Asynchronous-send"><span class="toc-text">Asynchronous send</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Blocking-x2F-Nonblocking"><span class="toc-text">Blocking &#x2F; Nonblocking</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Amdahl%E2%80%99s-Law"><span class="toc-text">Amdahl’s Law</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Process-Model-and-Language-Bindings"><span class="toc-text">Process Model and Language Bindings</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Headers"><span class="toc-text">Headers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Functions"><span class="toc-text">Functions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Initialize"><span class="toc-text">Initialize</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Finalize"><span class="toc-text">Finalize</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Start-MPI-program"><span class="toc-text">Start MPI program</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MPI-COMM-WORLD"><span class="toc-text">MPI_COMM_WORLD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Handles"><span class="toc-text">Handles</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Rank"><span class="toc-text">Rank</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Size"><span class="toc-text">Size</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#is-Parallel-awesome"><span class="toc-text">is Parallel ! awesome</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Messages-and-Point-to-Point-Communication"><span class="toc-text">Messages and Point-to-Point Communication</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Messages-in-Python"><span class="toc-text">Messages in Python</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Sending"><span class="toc-text">Sending</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Various-sending"><span class="toc-text">Various sending</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Which-is-better"><span class="toc-text">Which is better?</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Receiving"><span class="toc-text">Receiving</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#One-receiving"><span class="toc-text">One receiving</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#On-print-function-of-Python"><span class="toc-text">On print function of Python</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dead-locks"><span class="toc-text">Dead locks</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Status"><span class="toc-text">Status</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Message-Order-Preservation"><span class="toc-text">Message Order Preservation</span></a></li></ol></li></ol></li></ol></div><div class="column is-9"><header class="my-4"><a href="/tags/Research,%20Computer%20Science"><i class="tag post-item-tag">Research, Computer Science</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">MPI notes</h1><time class="has-text-grey" datetime="2023-04-05T14:14:23.000Z">2023-04-05</time><article class="mt-2 post-content"><h1 id="Crash-MPI"><a href="#Crash-MPI" class="headerlink" title="Crash MPI"></a>Crash MPI</h1><p>Following are basically the note when I went through <a target="_blank" rel="noopener" href="https://www.hlrs.de/training/self-study-materials">https://www.hlrs.de/training/self-study-materials</a>. This tutorial is highly recommended as it contains plenty of informative code exercises!</p>
<h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><h3 id="Sequential-vs-Parallel"><a href="#Sequential-vs-Parallel" class="headerlink" title="Sequential vs Parallel"></a>Sequential vs Parallel</h3><p>Sequential - One memory, one processor; all the works done in linear order</p>
<p>Parallel - Many memories, many processors; at different levels, processors may share the memory / communicate via MPI (Socket - Node - Cluster)</p>
<h3 id="SPMD"><a href="#SPMD" class="headerlink" title="SPMD"></a>SPMD</h3><p>mingle (sub-)program, multiple data </p>
<p>MPMD (multiple program, multiple data) can be implemented with ranks.</p>
<h3 id="rank-in-MPI"><a href="#rank-in-MPI" class="headerlink" title="rank in MPI"></a>rank in MPI</h3><p>the rank of each processor determines the behavior / role in the program</p>
<h3 id="First-MPI-example"><a href="#First-MPI-example" class="headerlink" title="First MPI example"></a>First MPI example</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mpi4py <span class="keyword">import</span> MPI</span><br><span class="line"></span><br><span class="line"><span class="comment"># application-related data</span></span><br><span class="line">n = <span class="literal">None</span></span><br><span class="line">result = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">comm_world = MPI.COMM_WORLD</span><br><span class="line"><span class="comment"># MPI-related data</span></span><br><span class="line">my_rank = comm_world.Get_rank() <span class="comment"># or my_rank = MPI.COMM_WORLD.Get_rank()</span></span><br><span class="line">num_procs = comm_world.Get_size() <span class="comment"># or ditto ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (my_rank == <span class="number">0</span>):</span><br><span class="line">   <span class="comment"># reading the application data "n" from stdin only by process 0:</span></span><br><span class="line">   n = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">"Enter the number of elements (n): "</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># broadcasting the content of variable "n" in process 0 </span></span><br><span class="line"><span class="comment"># into variables "n" in all other processes:</span></span><br><span class="line">n = comm_world.bcast(n, root=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># doing some application work in each process, e.g.:</span></span><br><span class="line">result = <span class="number">1.0</span> * my_rank * n</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"I am process <span class="subst">{my_rank}</span> out of <span class="subst">{num_procs}</span> handling the <span class="subst">{my_rank}</span>ith part of n=<span class="subst">{n}</span> elements, result=<span class="subst">{result}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (my_rank != <span class="number">0</span>):</span><br><span class="line">   <span class="comment"># sending some results from all processes (except 0) to process 0:</span></span><br><span class="line">   comm_world.send(result, dest=<span class="number">0</span>, tag=<span class="number">99</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">   <span class="comment"># receiving all these messages and, e.g., printing them </span></span><br><span class="line">   rank = <span class="literal">None</span></span><br><span class="line">   <span class="built_in">print</span>(<span class="string">f"I'm proc 0: My own result is <span class="subst">{result}</span>"</span>) </span><br><span class="line">   <span class="keyword">for</span> rank <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,num_procs):</span><br><span class="line">      result = comm_world.recv(source=rank, tag=<span class="number">99</span>)</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">f"I'm proc 0: received result of process <span class="subst">{rank}</span> is <span class="subst">{result}</span>"</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>Execution with <code>mpirun -np 4 python first-example.py</code> ; the output is</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Enter the number of elements (n): 100</span><br><span class="line">I am process 1 out of 4 handling the 1ith part of n=100 elements, result=100.0</span><br><span class="line">I am process 2 out of 4 handling the 2ith part of n=100 elements, result=200.0</span><br><span class="line">I am process 3 out of 4 handling the 3ith part of n=100 elements, result=300.0</span><br><span class="line">I am process 0 out of 4 handling the 0ith part of n=100 elements, result=0.0</span><br><span class="line">I'm proc 0: My own result is 0.0</span><br><span class="line">I'm proc 0: received result of process 1 is 100.0</span><br><span class="line">I'm proc 0: received result of process 2 is 200.0</span><br><span class="line">I'm proc 0: received result of process 3 is 300.0</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Bottom-lines"><a href="#Bottom-lines" class="headerlink" title="Bottom lines"></a>Bottom lines</h3><ol>
<li>The output of each process is in the well defined sequence of its program</li>
<li>The output from different processes can be intermixed in any sequence</li>
<li>A sub-program needs to be connected to a message passing system</li>
<li>The total program (i.e., all sub-programs of the program) must be started with the MPI startup tool</li>
</ol>
<h3 id="Messages-among-processors"><a href="#Messages-among-processors" class="headerlink" title="Messages among processors"></a>Messages among processors</h3><ul>
<li>process id (rank)</li>
<li>location (sender / reciever)</li>
<li>Data type (sender / reciever)</li>
<li>Data size (sender / reciever)</li>
</ul>
<h3 id="P2P-Communication"><a href="#P2P-Communication" class="headerlink" title="P2P Communication"></a>P2P Communication</h3><p>From one processor to another;</p>
<p>Two types: synchronous / asynchronous (buffered)</p>
<h4 id="Synchronous-send"><a href="#Synchronous-send" class="headerlink" title="Synchronous send"></a>Synchronous send</h4><p>Both sender and reciever works at the same time; sender recieved an info when finished;</p>
<p>This operation blocks sender until the receive is posted; receive operation blocks until message was sent</p>
<h4 id="Asynchronous-send"><a href="#Asynchronous-send" class="headerlink" title="Asynchronous send"></a>Asynchronous send</h4><p>Sender puts the data in the buffer and know nothing about if received</p>
<h3 id="Blocking-x2F-Nonblocking"><a href="#Blocking-x2F-Nonblocking" class="headerlink" title="Blocking / Nonblocking"></a>Blocking / Nonblocking</h3><p>Some operations may block until another process acts;</p>
<p>Non-block: returns immediately, allows the subprocess to continue the work</p>
<p><strong>All nonblocking procedures must have a matching wait (or test) procedure.</strong></p>
<h3 id="Amdahl’s-Law"><a href="#Amdahl’s-Law" class="headerlink" title="Amdahl’s Law"></a>Amdahl’s Law</h3><p>Extra cost of parallel sets a limitation of speedup $\propto 1/f$</p>
<h2 id="Process-Model-and-Language-Bindings"><a href="#Process-Model-and-Language-Bindings" class="headerlink" title="Process Model and Language Bindings"></a>Process Model and Language Bindings</h2><h3 id="Headers"><a href="#Headers" class="headerlink" title="Headers"></a>Headers</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mpi4py <span class="keyword">import</span> MPI</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">comm_world = MPI.COMM_WORLD</span><br><span class="line"></span><br><span class="line"><span class="comment"># Direct communication via numpy array</span></span><br><span class="line">comm_world.Send((snd_buf, ...), ...)</span><br><span class="line">comm_world.Recv((snd_buf, ...), ...)</span><br><span class="line"></span><br><span class="line"><span class="comment"># object-serialization or packled</span></span><br><span class="line">comm_world.send(snd_buf, ...)</span><br><span class="line">rcv_buf = comm_world.recv(...)</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Initialize"><a href="#Initialize" class="headerlink" title="Initialize"></a>Initialize</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mpi4py <span class="keyword">import</span> MPI</span><br><span class="line"><span class="comment"># MPI.Init()</span></span><br><span class="line"><span class="comment"># no need as included in the import operation</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="Finalize"><a href="#Finalize" class="headerlink" title="Finalize"></a>Finalize</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># MPI.Finalize()</span></span><br><span class="line"><span class="comment"># no need as automatically called at the end of progran</span></span><br></pre></td></tr></tbody></table></figure>

<p>No more MPI call after this (including re-initialize)</p>
<h3 id="Start-MPI-program"><a href="#Start-MPI-program" class="headerlink" title="Start MPI program"></a>Start MPI program</h3><p>With either <code>mpirun</code> or <code>mpiexec</code>; the latter is recommended for standard reasons.</p>
<h3 id="MPI-COMM-WORLD"><a href="#MPI-COMM-WORLD" class="headerlink" title="MPI_COMM_WORLD"></a>MPI_COMM_WORLD</h3><p>This is a pre-defined handler for all the processes; each is assigned with a rank (0, 1, …, np - 1)</p>
<h3 id="Handles"><a href="#Handles" class="headerlink" title="Handles"></a>Handles</h3><p>Handles are the idenfication of MPI objects;</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># predefined constants</span></span><br><span class="line">MPI.COMM_WORLD</span><br><span class="line"></span><br><span class="line"><span class="comment"># value returned by MPI routines</span></span><br><span class="line">sub_comm = MPI.COMM_WORLD.Split(...)</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Rank"><a href="#Rank" class="headerlink" title="Rank"></a>Rank</h3><p>Ranks are the identification of processes</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rank = comm.Get_rank()</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Size"><a href="#Size" class="headerlink" title="Size"></a>Size</h3><p>Total number of processors in the communicator (= max(rank) + 1)</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">size = comm.Get_size()</span><br></pre></td></tr></tbody></table></figure>

<h3 id="is-Parallel-awesome"><a href="#is-Parallel-awesome" class="headerlink" title="is Parallel ! awesome"></a>is Parallel ! awesome</h3><p>We cannot guarantee the order of output, unless the processors can communicate ahead of output.</p>
<h2 id="Messages-and-Point-to-Point-Communication"><a href="#Messages-and-Point-to-Point-Communication" class="headerlink" title="Messages and Point-to-Point Communication"></a>Messages and Point-to-Point Communication</h2><h3 id="Messages-in-Python"><a href="#Messages-in-Python" class="headerlink" title="Messages in Python"></a>Messages in Python</h3><p>There are two ways of messaging in Python</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Fast way, only for numpy</span></span><br><span class="line">comm_world.Send()</span><br><span class="line">comm_world.Recv()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Slow way, packled</span></span><br><span class="line">comm_world.send()</span><br><span class="line">comm_world.recv()</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Sending"><a href="#Sending" class="headerlink" title="Sending"></a>Sending</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">comm.Send(buf, <span class="built_in">int</span> dest, <span class="built_in">int</span> tag=<span class="number">0</span>)</span><br><span class="line">comm.send(obj, <span class="built_in">int</span> dest, <span class="built_in">int</span> tag=<span class="number">0</span>)</span><br></pre></td></tr></tbody></table></figure>

<p><code>buf</code> is a ndarry (or anything implement the Python buffer protocol) while <code>obj</code> can be any object;</p>
<p><code>dest</code> is the rank of the dest. processor;</p>
<p><code>tag</code> is a int with additional info from the sender (usually used to specify the data type)</p>
<h4 id="Various-sending"><a href="#Various-sending" class="headerlink" title="Various sending"></a>Various sending</h4><p><code>ssend</code> for synchronous send - Completes iff the receive has started</p>
<p><code>bsend</code> for buffered / async send - Always complete, need to specify the place of buffer</p>
<p><code>send</code> for standard send - Either buffered or synchronous, use interal buffer</p>
<p> <code>rsend</code> for ready send - Start only the receiver has been posted (?)</p>
<h4 id="Which-is-better"><a href="#Which-is-better" class="headerlink" title="Which is better?"></a>Which is better?</h4><p>Synchronous ones requires waiting — high latency but best bandwidth</p>
<p>Async ones — low latency but bad bandwidth</p>
<h3 id="Receiving"><a href="#Receiving" class="headerlink" title="Receiving"></a>Receiving</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">comm.Recv(buf, <span class="built_in">int</span> source=ANY_SOURCE, <span class="built_in">int</span> tag=ANY_TAG, Status status=<span class="literal">None</span>)</span><br><span class="line">obj = comm.recv(<span class="built_in">int</span> source=ANY_SOURCE, <span class="built_in">int</span> tag=ANY_TAG, Status status=<span class="literal">None</span>)</span><br></pre></td></tr></tbody></table></figure>

<p><code>buf</code> is the receive buffer;</p>
<p><code>source</code> is the rank of the src. processor;</p>
<p><code>tag</code> is still tag (tag must match!);</p>
<p>For Python, you need to match <code>Send</code>-<code>Recv</code> and <code>send</code>-<code>recv</code></p>
<h4 id="One-receiving"><a href="#One-receiving" class="headerlink" title="One receiving"></a>One receiving</h4><p><code>recv</code> can accpet all kind of <code>send</code> - Completes when a message arrived</p>
<h3 id="On-print-function-of-Python"><a href="#On-print-function-of-Python" class="headerlink" title="On print function of Python"></a>On <code>print</code> function of Python</h3><p>Following is the <code>pingpong</code> function:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mpi4py <span class="keyword">import</span> MPI</span><br><span class="line"></span><br><span class="line">buffer = [ <span class="literal">None</span> ]</span><br><span class="line"></span><br><span class="line">comm_world = MPI.COMM_WORLD</span><br><span class="line">my_rank = comm_world.Get_rank()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (my_rank == <span class="number">0</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"I am <span class="subst">{my_rank}</span> before send ping"</span>)</span><br><span class="line">    comm_world.send(buffer, dest=<span class="number">1</span>, tag=<span class="number">17</span>)</span><br><span class="line">    buf = comm_world.recv(source=<span class="number">1</span>, tag=<span class="number">17</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"I am <span class="subst">{my_rank}</span> after recv pong"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">elif</span> (my_rank == <span class="number">1</span>):</span><br><span class="line">    buf = comm_world.recv(source=<span class="number">0</span>, tag=<span class="number">17</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"I am <span class="subst">{my_rank}</span> after  recv ping"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"I am <span class="subst">{my_rank}</span> before send pong"</span>)</span><br><span class="line">    comm_world.send(buf, dest=<span class="number">0</span>, tag=<span class="number">17</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>My expectation output is</p>
 <figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">I am 0 before send ping</span><br><span class="line">I am 1 after  recv ping</span><br><span class="line">I am 1 before send pong</span><br><span class="line">I am 0 after recv pong</span><br></pre></td></tr></tbody></table></figure>

<p>Which demonstrates the order of send, recv operations; however, the real output is</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">I am 1 after  recv ping</span><br><span class="line">I am 1 before send pong</span><br><span class="line">I am 0 before send ping</span><br><span class="line">I am 0 after recv pong</span><br></pre></td></tr></tbody></table></figure>

<p>This is actually due to the feature of <code>print </code> rather than MPI: if we add time info into the output, we have</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">I am 1 after  recv ping 1680684130.3630078</span><br><span class="line">I am 1 before send pong 1680684130.363044</span><br><span class="line">I am 0 before send ping 1680684130.362919</span><br><span class="line">I am 0 after recv pong 1680684130.3631082</span><br></pre></td></tr></tbody></table></figure>

<p>Which means the order is #0 send -&gt; #1 recv -&gt; #1 send -&gt; #0 recv. So the flush is only emptied when finishing parallel.</p>
<h3 id="Dead-locks"><a href="#Dead-locks" class="headerlink" title="Dead locks"></a>Dead locks</h3><p>If Sync is used in send/recv, dead lock forms if two (or more) processors are waiting each other.</p>
<h3 id="Status"><a href="#Status" class="headerlink" title="Status"></a>Status</h3><p>These are info from src to dst; contains metadata of the communication</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">status.Get_source()</span><br><span class="line">status.Get_tag()</span><br><span class="line">status.Get_count()</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Message-Order-Preservation"><a href="#Message-Order-Preservation" class="headerlink" title="Message Order Preservation"></a>Message Order Preservation</h3><p>One link one order</p>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/2024/01/17/New-Year-2024/" title="年终总结 2023"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">Previous: 年终总结 2023</span></a><a class="button is-default" href="/2022/12/31/2022-summary/" title="年终总结"><span class="has-text-weight-semibold">Next: 年终总结</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"></section><p><span>Copyright ©</span><span> pointeee 2024</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" target="_blank" rel="noopener" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" target="_blank" rel="noopener" href="https://github.com/haojen/hexo-theme-Claudia" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/post.js"></script></body></html>